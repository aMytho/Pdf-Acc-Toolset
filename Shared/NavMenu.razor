@* Copyright (C) Jonathan Shull - See license file at github.com/amytho/pdf-acc-toolset *@
@using Pdf_Acc_Toolset.Services

<div class="top-row navbar navbar-dark">
    <div class="flex justify-between sm:justify-center h-full">
        <a class="navbar-brand self-center" href="">Pdf-Acc-Toolset</a>
        <button title="Navigation menu" class="navbar-toggler" @onclick="ToggleNavMenu">
            Toggle
        </button>
    </div>
</div>

<div class="@NavMenuCssClass">
    <nav class="flex flex-col">
        <div class="nav-item px-3">
            <NavLink class="nav-link" href="" Match="NavLinkMatch.All">
                <span class="oi" aria-hidden="true"></span> Import
            </NavLink>
        </div>
        <div class="nav-item px-3">
            <NavLink class="nav-link" href="tools" Match="NavLinkMatch.All">
                <span class="oi" aria-hidden="true"></span> Tools
            </NavLink>
        </div>
        <div class="nav-item px-3">
            <NavLink class="nav-link" href="tasks">
                <span class="oi" aria-hidden="true"></span> Queued Tasks
                @if (taskCounter != null)
                {
                    <Badge content="@taskCounter" />
                }
            </NavLink>
        </div>
        <div class="nav-item px-3">
            <NavLink class="nav-link" href="export" title="Review and Export">
                <span class="oi" aria-hidden="true"></span> Export
            </NavLink>
        </div>
        <div class="nav-item px-3">
            <NavLink class="nav-link" href="https://docs.pdf-accessibility.tools" target="_blank">
                <span class="oi" aria-hidden="true"></span> Documentation
            </NavLink>
        </div>
        @* Only show the dev menu in dev mode. *@
        @if (Config.Env.Equals("Development")) {
        <div class="nav-item px-3">
            <NavLink class="nav-link" href="testing">
                <span class="oi" aria-hidden="true"></span> DEV TEST
            </NavLink>
        </div>
        }
    </nav>
</div>

@code {
    private bool collapseNavMenu = false;

    private string NavMenuCssClass => collapseNavMenu ? "collapse" : null;

    // Counter of the non-completed tasks
    private string taskCounter = null;

    private void ToggleNavMenu()
    {
        collapseNavMenu = !collapseNavMenu;
    }

    protected override void OnInitialized()
    {
        // When the task amount changes, show the new value
        TaskManager.OnTaskAmountChanged += (sender, amount) =>
        {
            // If the task amount is 0, hide the badge. Else, display the new amount
            if (amount == 0) {
                taskCounter = null;
            } else {
                taskCounter = amount.ToString();
            }
            // Re-render badge
            StateHasChanged();
        };

        base.OnInitialized();
    }
}
